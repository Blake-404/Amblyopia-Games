<!doctype html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geologica:wght@100;400;700;900&display=swap" rel="stylesheet">
  </head>

  <body>

    <div id="snake">
        <div id="gameMarginTop"></div>
        <div id="grid"></div>   
        <div id="gameMarginBottom"></div>     
    </div>


    <style>

    </style>

    <script>
        // key listeners

        let currentDirection = undefined;

        document.addEventListener('keydown', (e) => {
            if (e.code === "ArrowUp") {
                currentDirection = "up";
            } else if (e.code === "ArrowDown") {
                currentDirection = "down";
            } else if (e.code === "ArrowLeft") {
                currentDirection = "left";
            } else if (e.code === "ArrowRight") {
                currentDirection = "right";
            }
        });

        // css controlling
        let setRootCss = (prop, val) => {
            document.documentElement.style.setProperty(prop, val);
        }

        /////////////////////////////////////////////////
        //////-------------- TETRIS ---------------//////
        /////////////////////////////////////////////////

        // data 
        let x = 15;
        let y = 25;
        const gridVolume = x * y;

        // needed data
            // current shape
            let currShapeCoords = [];
            // placed shapes

        // base grid
        let makeGrid = (x, y) => {

            setRootCss('--col-amt', x);
            let x_axis = 1;
            let y_axis = 0;
            for (i = 0; i < gridVolume; i++) {
                if (i % x === 0) {
                    x_axis = 0; 
                    y_axis += 1
                }
                x_axis += 1
                // const grid = document.createElement("div");
                const gridItem = document.createElement('div');
                gridItem.setAttribute('id', i);
                let coords = x_axis + "," + y_axis;
                gridItem.setAttribute('coords', coords);
                gridItem.setAttribute('class', 'grid-item');
                let text = document.createTextNode('');
                gridItem.appendChild(text);
                let grid = document.getElementById('grid');
                grid.appendChild(gridItem);
            }
        }

        let generateShape = (shape, rootCoord) => {

            let shape = undefined;
            if (shape === "random") {
                
            }
            let shapes = ["rhombus", "tee", "square", "line", "angle"];
            shape = shapes[Math.round(Math.random() * 5)]

            // create function to split rootCoord string, add/subtract values to x or y, return new coordString, push to current shape array
            let adjCoordStr = (coord, x, y) => {
                let coordArray = coord.split(",");
                let xCoord = Number(coordArray[0]);
                let yCoord = Number(coordArray[1]);
                xCoord += x;
                yCoord += y;
            }

            let shapeDefintions = {
                "rhombus": [[0, +1], [0, +2], [+1, +2], [+1, +3]],
                "tee" : [[0, +1], [0, +2], [+1, +2], [0, +3]],         
                "square" : [[0, +1], [+1, +1], [+1, +2], [+2, +2]],
                "line" : [[0, +1], [0, +2], [0, +3], [0, +4]],
                "angle" : [[0, +1], [0, +2], [0, +3], [+1, +3]]
            } 

            if (shape === "rhombus") {  for (let i = 0; i < 4; i++)  {  adjCoordStr(rootCoord, shapeDefintions["rhombus"][i][0], shapeDefintions["rhombus"][i][1])  }  } 
            if (shape === "tee") {  for (let i = 0; i < 4; i++) {  adjCoordStr(rootCoord, shapeDefintions["tee"][i][0], shapeDefintions["tee"][i][1])  }  }
            if (shape === "square") {  for (let i = 0; i < 4; i++) {  adjCoordStr(rootCoord, shapeDefintions["square"][i][0], shapeDefintions["square"][i][1])  }  }
            if (shape === "line") { for (let i = 0; i < 4; i++) {  adjCoordStr(rootCoord, shapeDefintions["line"][i][0], shapeDefintions["line"][i][1]) } }
            if (shape === "angle") { for (let i = 0; i < 4; i++) {  adjCoordStr(rootCoord, shapeDefintions["angle"][i][0], shapeDefintions["angle"][i][1]) } }

            console.log("generated shape")
        }

        let gameLogic = () => {
            //start of turn
            // shape generates, check if its intersection with existing, if so, game over

            // each tick moves shape downward, verifying blocks beneath are clear
                // if blocks arent clear
                    // freeze piece, evaluate position
                        // make any adjustments to board based off of new piece position (clearing lines, moving all pieces downward)

            let eachTick = () => {

            }

        }

        // game looping with 0.5s ticks
        let gameLoop = () => {
            gameLogic();
            // tick delay
            setTimeout(() => {
                i++;
                // console.log("tick - " + currentDirection);
                if (gameStatus) {
                    gameLoop();
                }
            }, 400)
        }

        // controller
        let runGame = () => {
            makeGrid(x, y); 
            gameLoop();
        }

        window.onload = runGame();

    </script>

  </body>
</html>